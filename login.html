{% load static %}
<!doctype html>
<html lang="fr" data-theme="light">
<head>
  <meta charset="utf-8" />
  <title>Connexion ‚Äì SNRT KPI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* Light defaults */
    :root{
      --snrt-green:#228B22; --snrt-red:#CD5C5C; --snrt-orange:#FF8C00; --snrt-blue:#4169E1;
      --glass-bg: rgba(255,255,255,0.72); --glass-border: rgba(0,0,0,0.08);
      --shadow: 0 10px 30px rgba(0,0,0,.08);
      --text:#111827;
      --bg-grad-1:#f7f9fc; --bg-grad-2:#eef3f9;
      --btn-outline:#D1D5DB;
    }
    /* Dark */
    html[data-theme="dark"]{
      --glass-bg: rgba(17,24,39,0.66);
      --glass-border: rgba(255,255,255,0.12);
      --shadow: 0 12px 36px rgba(0,0,0,.45);
      --text:#E5E7EB;
      --bg-grad-1:#0b1220; --bg-grad-2:#111827;
      --btn-outline:#374151;
    }
    body{
      color: var(--text);
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; min-height:100vh;
      background:
        radial-gradient(1000px 600px at 20% 0%, rgba(34,139,34,.10), transparent 60%),
        radial-gradient(1000px 600px at 80% 100%, rgba(65,105,225,.10), transparent 60%),
        linear-gradient(135deg,var(--bg-grad-1),var(--bg-grad-2));
      display:flex; align-items:center; justify-content:center; padding:24px;

      opacity:0; transition: opacity .35s ease;  /* fade */
    }
    body.page-loaded{ opacity:1; }

    .card{
      background:var(--glass-bg); backdrop-filter:saturate(130%) blur(6px);
      -webkit-backdrop-filter:saturate(130%) blur(6px);
      border:1px solid var(--glass-border); box-shadow:var(--shadow); border-radius:16px;
      width:100%; max-width:460px;
    }
    .logo-wrap img{ animation:breathe 6s ease-in-out infinite; }
    @keyframes breathe { 0%{transform:scale(1);opacity:.98} 50%{transform:scale(1.015);opacity:1} 100%{transform:scale(1);opacity:.98} }
    .btn-snrt{ background:var(--snrt-blue); border:none; }
    .btn-snrt:hover{ filter:brightness(0.96); }

    .theme-toggle{
      position: fixed; top: 16px; right: 16px;
      border-color: var(--btn-outline) !important;
      z-index: 10;
    }
  </style>
</head>
<body>

  <!-- Theme toggle -->
  <button id="themeToggle" class="btn btn-outline-secondary btn-sm theme-toggle" type="button" aria-label="Basculer le th√®me">
    <span id="themeIcon" aria-hidden="true">üåô</span>
  </button>

  <div class="card p-4 p-md-5">
    <div class="text-center mb-3 logo-wrap">
      <img src="{% static 'images/snrt_logo.jpg' %}" alt="Logo SNRT" height="72">
    </div>
    <h1 class="h4 text-center mb-3">Connexion au tableau de bord KPI</h1>

    {% if form.non_field_errors %}
      <div class="alert alert-danger py-2">
        {% for err in form.non_field_errors %}{{ err }}{% endfor %}
      </div>
    {% endif %}

    <form method="post" action="{% url 'login' %}" novalidate>
      {% csrf_token %}
      {% if next %}<input type="hidden" name="next" value="{{ next }}">{% endif %}

      <div class="mb-3">
        <label class="form-label">Nom d‚Äôutilisateur</label>
        <input type="text" name="username" required class="form-control" autocomplete="username"
               value="{{ form.username.value|default:'' }}">
        {% if form.username.errors %}
          <div class="text-danger small mt-1">{{ form.username.errors|striptags }}</div>
        {% endif %}
      </div>

      <div class="mb-3">
        <label class="form-label">Mot de passe</label>
        <input type="password" name="password" required class="form-control" autocomplete="current-password">
        {% if form.password.errors %}
          <div class="text-danger small mt-1">{{ form.password.errors|striptags }}</div>
        {% endif %}
      </div>

      <button class="btn btn-snrt text-white w-100">Se connecter</button>
    </form>

    <div class="text-center text-muted small mt-3">
      <a href="/" class="text-decoration-none">‚Üê Retour √† l‚Äôaccueil</a>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    (function(){
      // theme init
      const saved = localStorage.getItem('snrt-theme');
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      const theme = saved || (prefersDark ? 'dark' : 'light');
      document.documentElement.setAttribute('data-theme', theme);
      const icon = document.getElementById('themeIcon');
      if(icon) icon.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';

      const toggle = document.getElementById('themeToggle');
      if(toggle){
        toggle.addEventListener('click', () => {
          const current = document.documentElement.getAttribute('data-theme') || 'light';
          const next = current === 'light' ? 'dark' : 'light';
          document.documentElement.setAttribute('data-theme', next);
          localStorage.setItem('snrt-theme', next);
          if(icon) icon.textContent = next === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        });
      }

      // fade in
      window.addEventListener('DOMContentLoaded', () => {
        document.body.classList.add('page-loaded');
      });

      // fade out on link click
      document.addEventListener('click', (e) => {
        const a = e.target.closest('a');
        if(!a) return;
        const href = a.getAttribute('href') || '';
        const same = href && !href.startsWith('http') && !href.startsWith('#') && !a.hasAttribute('download');
        if(same){
          e.preventDefault();
          document.body.classList.remove('page-loaded');
          setTimeout(()=>{ window.location.href = href; }, 250);
        }
      });

      // fade out on form submit
      const form = document.querySelector('form[method="post"]');
      if(form){
        form.addEventListener('submit', () => {
          document.body.classList.remove('page-loaded');
        });
      }
    })();
  </script>
</body>
</html>
